## metadata for Audit benchmark
benchmark_version: '1.0.0'

# timeout for each command to run where set - default = 10seconds/10000ms
timeout_ms: 60000

# to enable rules that may have IO impact on a system e.g. full filesystem scans or CPU heavy
amzn2023cis_run_heavy_tests: true

#
host_os_distribution: Amazon2023

amzn2023cis_section1: true
amzn2023cis_section2: true
amzn2023cis_section3: true
amzn2023cis_section4: true
amzn2023cis_section5: true
amzn2023cis_section6: true

amzn2023cis_selinux_disable: false
amzn2023cis_selinux_state: enforcing

amzn2023cis_level_1: true
amzn2023cis_level_2: true

# if Bios boot
amzn2023cis_legacy_boot: true # change to false if uefi bootloader
amzn2023cis_bootloader_file: /boot/grub2/grub.cfg
amzn2023cis_bootloader_user: /boot/grub2/user.cfg

# These variables correspond with the CIS rule IDs or paragraph numbers defined in
# the CIS benchmark documents.
# PLEASE NOTE: These work in coordination with the section # group variables and tags.
# You must enable an entire section in order for the variables below to take effect.

# These variables correspond with the CIS rule IDs or paragraph numbers defined in
# the CIS benchmark documents.
# PLEASE NOTE: These work in coordination with the section # group variables and tags.
# You must enable an entire section in order for the variables below to take effect.
# Section 1 rules
amzn2023cis_rule_1_1_1_1: true
amzn2023cis_rule_1_1_1_2: true
amzn2023cis_rule_1_1_1_3: true
amzn2023cis_rule_1_1_1_4: true
amzn2023cis_rule_1_1_1_5: true
amzn2023cis_rule_1_1_1_6: true
amzn2023cis_rule_1_1_1_7: true
amzn2023cis_rule_1_1_2_1: true
amzn2023cis_rule_1_1_2_2: true
amzn2023cis_rule_1_1_2_3: true
amzn2023cis_rule_1_1_2_4: true
amzn2023cis_rule_1_1_3_1: true
amzn2023cis_rule_1_1_3_2: true
amzn2023cis_rule_1_1_3_3: true
amzn2023cis_rule_1_1_4_1: true
amzn2023cis_rule_1_1_4_2: true
amzn2023cis_rule_1_1_4_3: true
amzn2023cis_rule_1_1_4_4: true
amzn2023cis_rule_1_1_5_1: true
amzn2023cis_rule_1_1_5_2: true
amzn2023cis_rule_1_1_5_3: true
amzn2023cis_rule_1_1_5_4: true
amzn2023cis_rule_1_1_6_1: true
amzn2023cis_rule_1_1_6_2: true
amzn2023cis_rule_1_1_6_3: true
amzn2023cis_rule_1_1_6_4: true
amzn2023cis_rule_1_1_7_1: true
amzn2023cis_rule_1_1_7_2: true
amzn2023cis_rule_1_1_7_3: true
amzn2023cis_rule_1_1_8_1: true
amzn2023cis_rule_1_1_8_2: true
amzn2023cis_rule_1_1_8_3: true
amzn2023cis_rule_1_1_8_4: true
amzn2023cis_rule_1_1_18: true
amzn2023cis_rule_1_1_19: true
amzn2023cis_rule_1_1_20: true
amzn2023cis_rule_1_1_21: true
amzn2023cis_rule_1_1_9: true
amzn2023cis_rule_1_2_1: true
amzn2023cis_rule_1_2_2: true
amzn2023cis_rule_1_2_3: true
amzn2023cis_rule_1_2_4: true
amzn2023cis_rule_1_3_1: true
amzn2023cis_rule_1_3_2: true
amzn2023cis_rule_1_3_3: true
amzn2023cis_rule_1_4_1: true
amzn2023cis_rule_1_4_2: true
amzn2023cis_rule_1_5_1: true
amzn2023cis_rule_1_5_2: true
amzn2023cis_rule_1_5_3: true
amzn2023cis_rule_1_5_4: true
amzn2023cis_rule_1_6_1_1: true
amzn2023cis_rule_1_6_1_2: true
amzn2023cis_rule_1_6_1_3: true
amzn2023cis_rule_1_6_1_4: true
amzn2023cis_rule_1_6_1_5: true
amzn2023cis_rule_1_6_1_6: true
amzn2023cis_rule_1_6_1_7: true
amzn2023cis_rule_1_6_1_8: true
amzn2023cis_rule_1_7_1: true
amzn2023cis_rule_1_7_2: true
amzn2023cis_rule_1_7_3: true
amzn2023cis_rule_1_7_4: true
amzn2023cis_rule_1_7_5: true
amzn2023cis_rule_1_7_6: true
amzn2023cis_rule_1_8: true
amzn2023cis_rule_1_9: true

# Section 2 rules
amzn2023cis_rule_2_1_1: true
amzn2023cis_rule_2_1_2: true
amzn2023cis_rule_2_2_1: true
amzn2023cis_rule_2_2_2: true
amzn2023cis_rule_2_2_3: true
amzn2023cis_rule_2_2_4: true
amzn2023cis_rule_2_2_5: true
amzn2023cis_rule_2_2_6: true
amzn2023cis_rule_2_2_7: true
amzn2023cis_rule_2_2_8: true
amzn2023cis_rule_2_2_9: true
amzn2023cis_rule_2_2_10: true
amzn2023cis_rule_2_2_11: true
amzn2023cis_rule_2_2_12: true
amzn2023cis_rule_2_2_13: true
amzn2023cis_rule_2_2_14: true
amzn2023cis_rule_2_2_15: true
amzn2023cis_rule_2_2_16: true
amzn2023cis_rule_2_2_17: true
amzn2023cis_rule_2_2_18: true
amzn2023cis_rule_2_3_1: true
amzn2023cis_rule_2_3_2: true
amzn2023cis_rule_2_3_3: true
amzn2023cis_rule_2_3_4: true
amzn2023cis_rule_2_4: true

# Section 3 rules
amzn2023cis_rule_3_1_1: true
amzn2023cis_rule_3_1_2: true
amzn2023cis_rule_3_1_3: true
amzn2023cis_rule_3_1_4: true
amzn2023cis_rule_3_1_5: true
amzn2023cis_rule_3_2_1: true
amzn2023cis_rule_3_2_2: true
amzn2023cis_rule_3_3_1: true
amzn2023cis_rule_3_3_2: true
amzn2023cis_rule_3_3_3: true
amzn2023cis_rule_3_3_4: true
amzn2023cis_rule_3_3_5: true
amzn2023cis_rule_3_3_6: true
amzn2023cis_rule_3_3_7: true
amzn2023cis_rule_3_3_8: true
amzn2023cis_rule_3_3_9: true
amzn2023cis_rule_3_4_1_1: true
amzn2023cis_rule_3_4_1_2: true
amzn2023cis_rule_3_4_2_1: true
amzn2023cis_rule_3_4_2_2: true
amzn2023cis_rule_3_4_2_3: true
amzn2023cis_rule_3_4_2_4: true
amzn2023cis_rule_3_4_2_5: true
amzn2023cis_rule_3_4_2_6: true
amzn2023cis_rule_3_4_2_7: true

# Section 4 rules
amzn2023cis_rule_4_1_1: true
amzn2023cis_rule_4_1_2: true
amzn2023cis_rule_4_1_3: true
amzn2023cis_rule_4_1_4: true
amzn2023cis_rule_4_1_5: true
amzn2023cis_rule_4_1_6: true
amzn2023cis_rule_4_1_7: true
amzn2023cis_rule_4_1_8: true
amzn2023cis_rule_4_1_9: true
amzn2023cis_rule_4_2_1: true
amzn2023cis_rule_4_2_2: true
amzn2023cis_rule_4_2_3: true
amzn2023cis_rule_4_2_4: true
amzn2023cis_rule_4_2_5: true
amzn2023cis_rule_4_2_6: true
amzn2023cis_rule_4_2_7: true
amzn2023cis_rule_4_2_8: true
amzn2023cis_rule_4_2_9: true
amzn2023cis_rule_4_2_10: true
amzn2023cis_rule_4_2_11: true
amzn2023cis_rule_4_2_12: true
amzn2023cis_rule_4_2_13: true
amzn2023cis_rule_4_2_14: true
amzn2023cis_rule_4_2_15: true
amzn2023cis_rule_4_2_16: true
amzn2023cis_rule_4_2_17: true
amzn2023cis_rule_4_2_18: true
amzn2023cis_rule_4_2_19: true
amzn2023cis_rule_4_2_20: true

amzn2023cis_rule_4_3_1: true
amzn2023cis_rule_4_3_2: true
amzn2023cis_rule_4_3_3: true
amzn2023cis_rule_4_3_4: true
amzn2023cis_rule_4_3_5: true
amzn2023cis_rule_4_3_6: true

amzn2023cis_rule_4_4_1: true
amzn2023cis_rule_4_4_2: true

amzn2023cis_rule_4_5_1: true
amzn2023cis_rule_4_5_2: true
amzn2023cis_rule_4_5_3: true
amzn2023cis_rule_4_5_4: true

amzn2023cis_rule_4_6_1_1: true
amzn2023cis_rule_4_6_1_2: true
amzn2023cis_rule_4_6_1_3: true
amzn2023cis_rule_4_6_1_4: true
amzn2023cis_rule_4_6_1_5: true

amzn2023cis_rule_4_6_2: true
amzn2023cis_rule_4_6_3: true
amzn2023cis_rule_4_6_4: true
amzn2023cis_rule_4_6_5: true
amzn2023cis_rule_4_6_6: true

# Section 5 rules
amzn2023cis_rule_5_1_1_1: true
amzn2023cis_rule_5_1_1_2: true
amzn2023cis_rule_5_1_1_3: true
amzn2023cis_rule_5_1_1_4: true
amzn2023cis_rule_5_1_1_5: true
amzn2023cis_rule_5_1_1_6: true
amzn2023cis_rule_5_1_1_7: true

amzn2023cis_rule_5_1_2_1_1: true
amzn2023cis_rule_5_1_2_1_2: true
amzn2023cis_rule_5_1_2_1_3: true
amzn2023cis_rule_5_1_2_1_4: true

amzn2023cis_rule_5_1_2_2: true
amzn2023cis_rule_5_1_2_3: true
amzn2023cis_rule_5_1_2_4: true
amzn2023cis_rule_5_1_2_5: true
amzn2023cis_rule_5_1_2_6: true
amzn2023cis_rule_5_1_2_7: true

amzn2023cis_rule_5_1_3: true

amzn2023cis_rule_5_2_1_1: true
amzn2023cis_rule_5_2_1_2: true
amzn2023cis_rule_5_2_1_3: true
amzn2023cis_rule_5_2_1_4: true

amzn2023cis_rule_5_2_2_1: true
amzn2023cis_rule_5_2_2_2: true
amzn2023cis_rule_5_2_2_3: true

amzn2023cis_rule_5_2_3_1: true
amzn2023cis_rule_5_2_3_2: true
amzn2023cis_rule_5_2_3_3: true
amzn2023cis_rule_5_2_3_4: true
amzn2023cis_rule_5_2_3_5: true
amzn2023cis_rule_5_2_3_6: true
amzn2023cis_rule_5_2_3_7: true
amzn2023cis_rule_5_2_3_8: true
amzn2023cis_rule_5_2_3_9: true
amzn2023cis_rule_5_2_3_10: true
amzn2023cis_rule_5_2_3_11: true
amzn2023cis_rule_5_2_3_12: true
amzn2023cis_rule_5_2_3_13: true
amzn2023cis_rule_5_2_3_14: true
amzn2023cis_rule_5_2_3_15: true
amzn2023cis_rule_5_2_3_16: true
amzn2023cis_rule_5_2_3_17: true
amzn2023cis_rule_5_2_3_18: true
amzn2023cis_rule_5_2_3_19: true
amzn2023cis_rule_5_2_3_20: true
amzn2023cis_rule_5_2_3_21: true

amzn2023cis_rule_5_2_4_1: true
amzn2023cis_rule_5_2_4_2: true
amzn2023cis_rule_5_2_4_3: true
amzn2023cis_rule_5_2_4_4: true
amzn2023cis_rule_5_2_4_5: true
amzn2023cis_rule_5_2_4_6: true
amzn2023cis_rule_5_2_4_7: true
amzn2023cis_rule_5_2_4_8: true
amzn2023cis_rule_5_2_4_9: true
amzn2023cis_rule_5_2_4_10: true

amzn2023cis_rule_5_3: true

# Section 6 rules
amzn2023cis_rule_6_1_1: true
amzn2023cis_rule_6_1_2: true
amzn2023cis_rule_6_1_3: true
amzn2023cis_rule_6_1_4: true
amzn2023cis_rule_6_1_5: true
amzn2023cis_rule_6_1_6: true
amzn2023cis_rule_6_1_7: true
amzn2023cis_rule_6_1_8: true
amzn2023cis_rule_6_1_9: true
amzn2023cis_rule_6_1_10: true
amzn2023cis_rule_6_1_11: true
amzn2023cis_rule_6_1_12: true
amzn2023cis_rule_6_2_1: true
amzn2023cis_rule_6_2_2: true
amzn2023cis_rule_6_2_3: true
amzn2023cis_rule_6_2_4: true
amzn2023cis_rule_6_2_5: true
amzn2023cis_rule_6_2_6: true
amzn2023cis_rule_6_2_7: true
amzn2023cis_rule_6_2_8: true
amzn2023cis_rule_6_2_9: true
amzn2023cis_rule_6_2_10: true
amzn2023cis_rule_6_2_11: true

## Section 1 vars

#### 1.1.2
# These settings go into the /etc/fstab file for the /tmp mount settings
# The value must contain nosuid,nodev,noexec to conform to CIS standards
# amzn2023cis_tmp_tmpfs_settings: "defaults,rw,nosuid,nodev,noexec,relatime 0 0"
# If set true uses the tmp.mount service else using fstab configuration
amzn2023cis_tmp_svc: false

#### 1.1.9
amzn2023cis_allow_autofs: false

# 1.9 Set crypto policy (LEGACY, DEFAULT, FUTURE, FIPS)
# Control 1.9 states do not use LEGACY
amzn2023cis_crypto_policy: 'DEFAULT'
# Added module to be allowed as default setting (Allowed options in vars/main.yml)
amzn2023cis_crypto_policy_module: ''

### 2.1 Time Synchronization
#### 2.1.2 Time Synchronization servers - used in template file chrony.conf.j2
amzn2023cis_time_synchronization_servers:
    - 0.pool.ntp.org
    - 1.pool.ntp.org
    - 2.pool.ntp.org
    - 3.pool.ntp.org
amzn2023cis_chrony_server_options: "minpoll 8"

# System network parameters (host only OR host and router)
amzn2023cis_is_router: false

# IPv6 required
amzn2023cis_ipv6_required: true

# AIDE
amzn2023cis_config_aide: true
# AIDE cron settings
amzn2023cis_aide_cron:
    cron_user: root
    cron_file: /etc/cron.d/aide_cron
    aide_job: '/usr/sbin/aide --check'
    aide_minute: 0
    aide_hour: 5
    aide_day: '*'
    aide_month: '*'
    aide_weekday: '*'

# SELinux policy
amzn2023cis_selinux_pol: targeted
# chose onf or enfocing or permissive
amzn2023cis_selinux_enforce: enforcing
# Warning Banner Content (issue, issue.net, motd)
amzn2023cis_warning_banner: Authorized uses only. All activity may be monitored and reported.
# End Banner

# Set to 'true' if X Windows is needed in your environment
amzn2023cis_xwindows_required: false

# Whether or not to run tasks related to auditing/patching the desktop environment
amzn2023cis_gui: false


# IPv6 required
amzn2023cis_ipv6_required: false

# System network parameters (host only OR host and router)
amzn2023cis_is_router: false

# Time Synchronization
amzn2023cis_time_synchronization: chrony
#  amzn2023cis_time_synchronization: ntp


### 2.3 Special Purposes
##### Service configuration booleans set true to keep service
amzn2023cis_avahi_server: false
amzn2023cis_cups_server: false
amzn2023cis_dhcp_server: false
amzn2023cis_dovecot_server: false
amzn2023cis_dns_server: false
amzn2023cis_dnsmasq_server: false
amzn2023cis_vsftpd_server: false
amzn2023cis_tftp_server: false
amzn2023cis_httpd_server: false
amzn2023cis_is_mail_server: false
amzn2023cis_nginx_server: false
amzn2023cis_imap_server: false
amzn2023cis_samba_server: false
amzn2023cis_squid_server: false
amzn2023cis_snmp_server: false
amzn2023cis_telnet_server: false

# The follow are set to remove or mask
amzn2023cis_nfs_server: mask
amzn2023cis_rpc_server: mask
amzn2023cis_rsync_server: mask
# snmp can be a dependacy for many packages - it is masked only by default if installed


# Note the options
# Packages are used for client services and Server- only remove if you dont use the client service
#



#### 2.3 Service clients
amzn2023cis_telnet_required: false
amzn2023cis_openldap_clients_required: false
amzn2023cis_ftp_client: false

# set firewall type
amzn2023cis_firewall: firewalld
amzn2023cis_default_zone: public

## Section4 vars

# This will allow use of drop in files when CIS adopts them.
amzn2023cis_sshd_config_file: /etc/ssh/sshd_config

amzn2023cis_sshd:
    clientalivecountmax: 0
    clientaliveinterval: 900
    logingracetime: 60
    # WARNING: make sure you understand the precedence when working with these values!!
    # allowusers:
    # allowgroups: systems dba
    # denyusers:
    # denygroups:

amzn2023cis_sshd_limited: false
amzn2023cis_sshd_access:
  - AllowUser
  - AllowGroup
  - DenyUser
  - DenyGroup

# 4.2.5 SSH LogLevel setting. Options are INFO or VERBOSE
amzn2023cis_ssh_loglevel: INFO

# 4.2.19 SSH MaxSessions setting. Must be 4 our less
amzn2023cis_ssh_maxsessions: 4
amzn2023cis_inactivelock:
    lock_days: 30


# 4.3.3 var log location variable
amzn2023cis_sudolog_location: "/var/log/sudo.log"

#### 4.3.6
amzn2023cis_sudo_timestamp_timeout: 15

amzn2023cis_sugroup: nosugroup

# Session timeout setting file (TMOUT setting can be set in multiple files)
# Timeout value is in seconds. (60 seconds * 10 = 600)
amzn2023cis_shell_session_timeout:
    file: /etc/profile.d/tmout.sh
    timeout: 600
# Allow ansible to expire password for account with a last changed date in the future. False will just display users in violation, true will expire those users passwords
amzn2023cis_futurepwchgdate_autofix: true

# 4.5.1
## PAM
amzn2023cis_pam_password:
    minlen: 14
    minclass: 4
amzn2023cis_pam_passwd_retry: "3"

amzn2023cis_pam_faillock:
    unlock_time: 900
    deny: 5
    remember: 5

amzn2023cis_pass:
    max_days: 365
    min_days: 7
    warn_age: 7

## Section5 vars

## Preferred method of logging
## Whether rsyslog or journald preferred method for local logging
## Affects rsyslog cis 4.2.1.3 and journald cis 4.2.2.5
amzn2023cis_syslog_service: rsyslog
amzn2023cis_rsyslog_ansiblemanaged: true

#### remote and destination log server name
amzn2023cis_remote_log_server: false
amzn2023cis_remote_log_host: logagg.example.com
amzn2023cis_remote_log_port: 514
amzn2023cis_remote_log_protocol: tcp
amzn2023cis_remote_log_retrycount: 100
amzn2023cis_remote_log_queuesize: 1000

####
amzn2023cis_system_is_log_server: false

#
# amzn2023cis_journal_upload_url is the ip address to upload the journal entries to
amzn2023cis_journal_upload_url: 192.168.50.42
# The paths below have the default paths/files, but allow user to create custom paths/filenames
amzn2023cis_journal_upload_serverkeyfile: "/etc/ssl/private/journal-upload.pem"
amzn2023cis_journal_servercertificatefile: "/etc/ssl/certs/journal-upload.pem"
amzn2023cis_journal_trustedcertificatefile: "/etc/ssl/ca/trusted.pem"

#
# The variables below related to journald, please set these to your site specific values
# amzn2023cis_journald_systemmaxuse is the max amount of disk space the logs will use
amzn2023cis_journald_systemmaxuse: 10M
# amzn2023cis_journald_systemkeepfree is the amount of disk space to keep free
amzn2023cis_journald_systemkeepfree: 100G
amzn2023cis_journald_runtimemaxuse: 10M
amzn2023cis_journald_runtimekeepfree: 100G
# amzn2023cis_journald_MaxFileSec is how long in time to keep log files. Values are Xm, Xh, Xday, Xweek, Xmonth, Xyear, for example 2week is two weeks
amzn2023cis_journald_maxfilesec: 1month

####
amzn2023cis_logrotate: "daily"

### Configure System Accounting
#### Configure Data Retention
amzn2023cis_auditd:
    space_left_action: email
    action_mail_acct: root
    admin_space_left_action: halt
    max_log_file_action: keep_logs
    auditd_backlog_limit: '8192'

## Advanced option found in auditd post
amzn2023cis_allow_auditd_uid_user_exclusions: false

# This can be used to configure other keys in auditd.conf
amzn2023cis_auditd_extra_conf: {}
# Example:
# amzn2023cis_auditd_extra_conf:
#     admin_space_left: '10%'
